<h3><%= @post.title %></h3>

<div class="jumbotron" onload="render();">
  <div class="row">
    <!-- Mostrar el contenido del post -->
    <h3><%=markdown(@post.content) %></h3>
    <h5>
      Creado el: <%= @post.created_at %>
    </h5>
    <div>
      <% if user_signed_in? %>
        <%= link_to like_post_path(@post), method: :put, class: 'vote-link' do %>
          <% if current_user.liked?(@post)%>
            <span class="badge badge-liked">
          <% else%>
            <span class="badge">
          <% end %>
              <%= @post.get_likes.size%>
              <span class="glyphicon glyphicon-thumbs-up"></span>
            </span>
        <% end %>
        <%= link_to dislike_post_path(@post), method: :put, class: 'vote-link' do %>
          <% if current_user.disliked?(@post)%>
            <span class="badge badge-disliked">
          <% else%>
            <span class="badge">
          <% end %>
            <span class="glyphicon glyphicon-thumbs-down icon-rotate icon-flipped"></span>
            <%= @post.get_dislikes.size%>
          </span>
        <% end %>
        &nbsp;&nbsp;
        <!-- Agregar favorito -->
        <%if user_signed_in?()%>
            <% if Favourite.where(post: @post, user: current_user).length() != 0 %>
              <%= link_to( favourites_path({post_id: @post.id}),method: :delete,
                        class: 'btn btn-default') do%>
                Suscrito <%= @post.subcribers%>
              <% end %>
            <% else %>
              <%= link_to(favourites_path({post_id: @post.id}),method: :post, class: 'btn btn-danger') do %>
                Suscribirse
              <% end %>
            <% end%>
        <% end %>
        &nbsp;
        <% @category = Category.find(@post.category_id) %>
        <%if current_user.has_role?(:moderator, @category) or current_user.has_role?(:admin) %>
            <!-- Borrar post -->
            <%=link_to("", post_path(@post.id),
                      html_options = {class: "glyphicon glyphicon-trash", method: :delete,
                                      data: {confirm: "Â¿Deseas borrar este post?"}})%>
        <% end %>
      <% end %>
    </div>
  </div>
</div>

<%= render(@comentarios) %>

<%if user_signed_in?()%>
  <div class="jumbotron">
    <div class="row">
      <h2>Comentar</h2>
      <%= form_for(:commentary, url: commentaries_path(), class: "form-horizontal") do |f| %>
        <!-- Enviar escondido el id del post y del usuario -->
        <%= hidden_field_tag "commentary[post_id]", "#{@post.id}" %>
        <%= hidden_field_tag "commentary[user_id]", current_user.id %>
        <div class="form-group">
          <%= f.label("Comenta aqui: ") %><br />
          <%= f.text_area(:text, rows: 15, placeholder: "Escribe tu comentario aqui...", class: "form-control") %>
        </div>
      <div class="actions">
          <%= f.submit("Crear", class: "btn btn-primary active") %>
        </div>
      <% end %>
    </div>
  </div>
<%end%>

<script>
  function render() {
      if (window.location !== window.top.location) {
          window.top.location = window.location;
      }
  };
</script>
